template <typename T>
struct ApplyPSGLD<CPUDevice, T> {
  void operator()(const CPUDevice& d,
                  typename TTypes<T>::Flat var, typename TTypes<T>::Flat ms,
                  typename TTypes<T>::Flat mom, typename TTypes<T>::Flat rnd,
                  typename TTypes<T>::ConstScalar lr,
                  typename TTypes<T>::ConstScalar decay,
                  typename TTypes<T>::ConstScalar momentum,
                  typename TTypes<T>::ConstScalar epsilon,
                  typename TTypes<T>::ConstFlat grad) {
    ms.device(d) += (grad.square() - ms) * (static_cast<T>(1) - decay());
    mom.device(d) =
        mom * momentum() + (grad * lr()) / ((ms + epsilon()).sqrt())
        + ( static_cast<T>(2) * lr() / ((ms + epsilon()).sqrt()) ).sqrt() * rnd;
    var.device(d) -= mom;
  }
};
